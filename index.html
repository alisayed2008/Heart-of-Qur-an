<!doctype html>
<html lang="ar">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ø®Ø±ÙŠØ·Ø© Ø­ÙØ¸ Ø§Ù„Ù‚Ø±Ø¢Ù† â€” Ø§Ù„Ù‚Ù„Ø¨</title>
<link href="https://fonts.googleapis.com/css2?family=El+Messiri:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg: #ffffff;
    --card: #fbfdff;
    --accent: #ff4d4d;
    --accent-strong: #e60000;
    --muted: #6b7280;
    --shadow: 0 12px 40px rgba(2,6,23,0.08);
    --glass: rgba(255,255,255,0.6);
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:'El Messiri',sans-serif;background:var(--bg);color:#071133}
  .wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:28px;}
  .panel{width:100%;max-width:1100px;border-radius:16px;background:linear-gradient(180deg,#fff,#fcfdff);box-shadow:var(--shadow);display:flex;gap:20px;padding:20px;}
  /* LEFT - HEART CARD */
  .card{flex:0 0 680px;padding:18px;border-radius:12px;background:linear-gradient(180deg,#ffffff,#fbfdff);border:1px solid #eef4fb}
  .card-header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}
  .title{font-size:18px;font-weight:700}
  .sub{color:var(--muted);font-size:13px}
  .heart-container{background:linear-gradient(180deg,#fff,#f7fbff);padding:16px;border-radius:12px;border:1px solid #eef6fc;display:flex;align-items:center;justify-content:center;min-height:420px}
  svg{max-width:100%;height:auto;display:block}
  /* SEGMENTS styling */
  .segment{fill:transparent;stroke:#000;stroke-width:1.6;cursor:pointer;transition:transform .18s ease, filter .18s ease}
  .segment:hover{transform:translateY(-4px);filter:drop-shadow(0 10px 20px rgba(3,7,18,0.06))}
  .segment.revealed{fill:var(--accent); transition:fill .4s ease}
  .segment.anim-stroke{stroke:var(--accent);stroke-width:2.6;fill:transparent}
  /* RIGHT - SIDEBAR */
  .sidebar{flex:1;min-width:260px;display:flex;flex-direction:column;gap:12px}
  .panel-block{background:#fff;padding:12px;border-radius:10px;border:1px solid #f0f6fb;box-shadow:0 6px 18px rgba(12,15,35,0.03)}
  .progress-bar{height:12px;background:#eef6fb;border-radius:8px;overflow:hidden}
  .progress-fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--accent-strong));width:0%;transition:width .6s ease}
  .big-num{font-weight:700;font-size:18px}
  .muted{color:var(--muted);font-size:13px}
  .controls{display:flex;gap:8px;align-items:center;justify-content:flex-end}
  button.btn{background:var(--accent);color:white;padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:700;box-shadow:0 8px 20px rgba(255,77,77,0.14)}
  button.ghost{background:transparent;border:1px solid #e6eef7;color:var(--muted);padding:8px 12px;border-radius:10px;cursor:pointer}
  /* modal */
  .modal-backdrop{position:fixed;inset:0;background:rgba(2,6,23,0.45);display:none;align-items:center;justify-content:center;z-index:60}
  .modal{background:white;padding:18px;border-radius:12px;min-width:320px;box-shadow:0 18px 60px rgba(2,6,23,0.25)}
  .modal h3{margin:0 0 8px}
  .modal p{margin:0 0 14px;color:var(--muted)}
  .modal .row{display:flex;gap:10px;justify-content:flex-end}
  /* small */
  footer.note{font-size:13px;color:var(--muted);margin-top:8px}
  @media (max-width:980px){.panel{flex-direction:column}.card{width:100%}}
</style>
</head>
<body>
<div class="wrap">
  <div class="panel">
    <div class="card">
      <div class="card-header">
        <div>
          <div class="title">Ø®Ø±ÙŠØ·Ø© Ø­ÙØ¸ Ø§Ù„Ù‚Ø±Ø¢Ù† â€” Ø§Ù„Ù‚Ù„Ø¨</div>
          <div class="sub">Ø§Ø¶ØºØ· Ø£ÙŠ Ø¬Ø²Ø¡ Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­ÙØ¸. Ø§Ù„ØªÙ‚Ø¯Ù… ÙŠÙØ®Ø²Ù‘Ù† Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ.</div>
        </div>
        <div class="controls">
          <button class="ghost" id="btn-list" title="Ø¹Ø±Ø¶ Ø§Ù„Ø³ÙˆØ± Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©">Ù‚Ø§Ø¦Ù…Ø©</button>
          <button class="btn" id="btn-reset" title="Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙ‚Ø¯Ù…">Ø¥Ø¹Ø§Ø¯Ø©</button>
        </div>
      </div>

      <div class="heart-container" id="heart-wrap">
        <!-- SVG Ø³ÙŠÙØ­Ù…ÙÙ‘Ù„ ÙˆÙŠÙØ­Ù‚ÙÙ† Ù‡Ù†Ø§ (Ù„Ø§ ØªØ¹Ø±Ø¶ ÙƒÙƒÙˆØ¯) -->
        <div id="svg-loader" class="muted">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ù„Ø¨â€¦</div>
      </div>

      <footer class="note">Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª ÙˆØ­Ø±ÙƒØ§Øª Ø¨Ø³ÙŠØ·Ø©ØŒ Ù„Ùˆ Ø¹Ø§ÙŠØ² Ù†Ø²ÙˆÙ‘Ø¯ Ù…Ø¤Ø«Ø±Ø§Øª ØµÙˆØªÙŠØ© Ø£Ùˆ Ø¶ÙˆØ¡ Ø¹Ù†Ø¯ Ø§Ù„ØªÙ„ÙˆÙŠÙ† Ø£Ø¶ÙÙ‡Ø§ Ù„ÙŠ Ùˆ Ø£Ø¹Ù…Ù„Ù‡Ø§ Ù„Ùƒ.</footer>
    </div>

    <aside class="sidebar">
      <div class="panel-block">
        <div class="muted">Ø§Ù„ØªÙ‚Ø¯Ù…</div>
        <div style="display:flex;align-items:center;justify-content:space-between;margin-top:8px">
          <div class="big-num" id="count-text">0 / 0</div>
          <div class="muted" id="last-text">Ù„Ø§ Ø´ÙŠØ¡ Ù…Ø­ÙÙˆØ¸</div>
        </div>
        <div style="margin-top:12px" class="progress-bar">
          <div id="progress-fill" class="progress-fill"></div>
        </div>
      </div>

      <div class="panel-block">
        <div class="muted">Ø±Ø³Ø§Ø¦Ù„ ØªØ´Ø¬ÙŠØ¹</div>
        <div style="margin-top:10px;font-weight:600" id="encourage">Ø§Ø¨Ø¯Ø£ Ø§Ù„ÙŠÙˆÙ… â€” Ø®Ø·ÙˆØ© Ø®Ø·ÙˆØ© ğŸŒ¿</div>
      </div>

      <div class="panel-block">
        <div class="muted">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</div>
        <ul style="margin:10px 0 0 18px;color:var(--muted);font-size:14px">
          <li>Ø§Ù„Ù‚Ù„Ø¨ Ø¨Ù„ÙˆÙ† Ø­ÙˆØ§Ù Ø£Ø³ÙˆØ¯ Ø­Ø³Ø¨ Ø·Ù„Ø¨Ùƒ.</li>
          <li>Ø§Ù„ØªÙ„ÙˆÙŠÙ† ÙŠØ¸Ù‡Ø± Ø¨Ø¹Ø±Ø¶ Ø£Ù†ÙŠÙ…Ø´Ù† Ù‚Ù„Ù… Ø«Ù… ØªØ¹Ø¨Ø¦Ø©.</li>
          <li>Ø§Ù„ØªÙ‚Ø¯Ù… ÙŠÙØ®Ø²Ù‘Ù† Ù…Ø­Ù„ÙŠÙ‹Ø§ Ø¹Ù„Ù‰ Ù…ØªØµÙØ­Ùƒ (localStorage).</li>
        </ul>
      </div>
    </aside>
  </div>
</div>

<!-- Modal Confirm -->
<div id="modal" class="modal-backdrop" aria-hidden="true">
  <div class="modal" role="dialog">
    <h3 id="modal-title">ØªØ£ÙƒÙŠØ¯ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø­ÙØ¸</h3>
    <p id="modal-body">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥ØªÙ…Ø§Ù… Ø­ÙØ¸ Ø³ÙˆØ±Ø© ...ØŸ</p>
    <div class="row">
      <button class="ghost" id="modal-cancel">Ø¥Ù„ØºØ§Ø¡</button>
      <button class="btn" id="modal-confirm">Ù…ØªØ£ÙƒØ¯</button>
    </div>
  </div>
</div>

<script>
/*
  Ù‡Ø°Ø§ Ø§Ù„Ø³ÙƒØ±Ø¨Øª:
  - ÙŠØ­Ù…Ù„ SVG Ù…Ù† Ù…Ù„Ù heart_segments_named.svg
  - ÙŠØ­Ù‚Ù†Ù‡ Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙØ­Ø© ÙˆÙŠØ¬Ø¹Ù„ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø°Ø§Øª Ø§Ù„ØµÙ†Ù .segment Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ù†Ù‚Ø±
  - ÙŠØ¹Ø±Ø¶ Ù…ÙˆØ¯Ø§Ù„ ØªØ£ÙƒÙŠØ¯ Ø«Ù… ÙŠÙ‚ÙˆÙ… Ø¨Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ù‚Ù„Ù… Ø«Ù… ÙŠÙ„ÙˆÙ† Ø§Ù„Ø¬Ø²Ø¡
  - ÙŠØ®Ø²Ù† Ø§Ù„ØªÙ‚Ø¯Ù… ÙÙŠ localStorage ØªØ­Øª Ø§Ù„Ù…ÙØªØ§Ø­ quran_heart_progress
  - ÙŠØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø£ÙŠ Ø¹Ø¯Ø¯ Ù…Ù† Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ ÙØ¹Ù„ÙŠÙ‹Ø§ (ÙŠØ¹Ø±Ø¶ Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ)
*/

const SVG_FILE = 'heart_segments_named.svg'; // ØºÙŠÙ‘Ø± Ø§Ù„Ø§Ø³Ù… Ù„Ùˆ Ø¹Ù†Ø¯Ùƒ Ø§Ø³Ù… Ø¢Ø®Ø±

// Ø¹Ù†Ø§ØµØ± DOM
const heartWrap = document.getElementById('heart-wrap');
const loader = document.getElementById('svg-loader');
const modalEl = document.getElementById('modal');
const modalTitle = document.getElementById('modal-title');
const modalBody = document.getElementById('modal-body');
const modalCancel = document.getElementById('modal-cancel');
const modalConfirm = document.getElementById('modal-confirm');
const progressFill = document.getElementById('progress-fill');
const countText = document.getElementById('count-text');
const lastText = document.getElementById('last-text');
const encourage = document.getElementById('encourage');
const btnReset = document.getElementById('btn-reset');
const btnList = document.getElementById('btn-list');

let segments = []; // Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù€SVG Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ù‚Ù†
let saved = JSON.parse(localStorage.getItem('quran_heart_progress') || '{}') || {};
if (!saved || typeof saved !== 'object') saved = {};

async function loadAndInjectSVG(){
  try{
    const res = await fetch(SVG_FILE);
    if(!res.ok) throw new Error('SVG not found');
    const text = await res.text();
    // Ù†Ø­Ø· Ø§Ù„Ù€SVG Ø¯Ø§Ø®Ù„ Ø§Ù„Ù€container
    heartWrap.innerHTML = text;
    // Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ù‚Ù† Ù†Ø¬Ù„Ø¨ Ø§Ù„Ø¹Ù†Ø§ØµØ±
    segments = Array.from(heartWrap.querySelectorAll('.segment'));
    loader && loader.remove();
    initializeSegments();
    updateUI();
  } catch(err){
    loader.innerText = 'Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù: ' + err.message;
    console.error(err);
  }
}

function updateUI(){
  const total = segments.length;
  const done = Object.keys(saved).filter(k => k !== '_last').length;
  countText.textContent = `${done} / ${total}`;
  lastText.textContent = saved._last ? `Ø¢Ø®Ø±: ${saved._last}` : 'Ù„Ø§ Ø´ÙŠØ¡ Ù…Ø­ÙÙˆØ¸';
  progressFill.style.width = total ? `${Math.round((done/total)*100)}%` : '0%';
}

function initializeSegments(){
  if(!segments.length){
    heartWrap.querySelector('#svg-loader')?.remove();
    heartWrap.insertAdjacentHTML('beforeend','<div class="muted">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù‚Ø§Ø·Ø¹ (segments) ÙÙŠ Ø§Ù„Ù€SVG</div>');
    return;
  }

  segments.forEach(seg=>{
    const name = seg.getAttribute('data-name') || seg.getAttribute('id') || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
    // ensure pointer, black stroke
    seg.style.stroke = seg.style.stroke || '#000';
    seg.style.cursor = 'pointer';

    if(saved[name]){
      seg.classList.add('revealed');
    }

    // prepare stroke dash (for path-like elements). try-catch in case element doesn't support.
    try{
      const len = seg.getTotalLength();
      seg.style.strokeDasharray = len;
      seg.style.strokeDashoffset = len;
      seg.dataset._len = len;
    } catch(e){}

    seg.addEventListener('click', (e)=>{
      e.preventDefault();
      if(saved[name]) {
        // Ù…Ù…ÙƒÙ† Ù†Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ØµØºÙŠØ±Ø© Ø£Ùˆ Ù†ÙØªØ­ Ù†Ø§ÙØ°Ø© Ù„ØªØ£ÙƒÙŠØ¯ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø­ÙØ¸ â€” Ø­Ø§Ù„ÙŠÙ‹Ø§ Ù†ÙØ¹Ù„ Ù„Ø§ Ø´ÙŠØ¡
        encourage.textContent = `Ù„Ù‚Ø¯ Ø³Ø¨Ù‚ Ø­ÙØ¸ "${name}".`;
        return;
      }
      // Ø§ÙØªØ­ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ù…Ø¹ Ø§Ø³Ù… Ø§Ù„Ø³ÙˆØ±Ø©
      modalTitle.textContent = 'ØªØ£ÙƒÙŠØ¯ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø­ÙØ¸';
      modalBody.textContent = `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥ØªÙ…Ø§Ù… Ø­ÙØ¸ Ø³ÙˆØ±Ø© "${name}"ØŸ`;
      modalEl.style.display = 'flex';
      modalEl.dataset.target = name;
    });
  });
}

// modal handlers
modalCancel.addEventListener('click', ()=>{ modalEl.style.display='none'; modalEl.dataset.target=''; });
modalConfirm.addEventListener('click', ()=>{
  const name = modalEl.dataset.target;
  if(!name) return modalEl.style.display='none';
  // Ø§ÙŠØ¬Ø§Ø¯ Ø§Ù„Ø¹Ù†ØµØ±
  const seg = segments.find(s => (s.getAttribute('data-name') || s.getAttribute('id')) === name);
  if(!seg){ modalEl.style.display='none'; return; }

  // animation: stroke dash then fill
  try{
    const len = Number(seg.dataset._len) || seg.getTotalLength();
    seg.classList.add('anim-stroke');
    // force reflow
    void seg.getBoundingClientRect();
    seg.style.transition = 'stroke-dashoffset 0.45s linear';
    seg.style.strokeDashoffset = '0';
    // Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø£Ù†Ù…ÙŠØ´Ù† Ø§Ù„Ø®Ø·ØŒ Ù†Ù…Ù„Ø£
    const onEnd = (ev) => {
      if(ev.propertyName !== 'stroke-dashoffset') return;
      seg.removeEventListener('transitionend', onEnd);
      seg.classList.remove('anim-stroke');
      seg.classList.add('revealed');
      // reset dashoffset
      seg.style.strokeDashoffset = len;
      seg.style.transition = 'fill 0.3s ease';
      // save
      saved[name] = true;
      saved._last = name;
      localStorage.setItem('quran_heart_progress', JSON.stringify(saved));
      updateUI();
      encourage.textContent = `Ù…Ø§ Ø´Ø§Ø¡ Ø§Ù„Ù„Ù‡! ØªÙ… Ø­ÙØ¸ "${name}". Ø§Ø³ØªÙ…Ø± ğŸŒŸ`;
      modalEl.style.display = 'none';
    };
    seg.addEventListener('transitionend', onEnd);
  } catch(e){
    // fallback
    seg.classList.add('revealed');
    saved[name] = true;
    saved._last = name;
    localStorage.setItem('quran_heart_progress', JSON.stringify(saved));
    updateUI();
    encourage.textContent = `Ù…Ø§ Ø´Ø§Ø¡ Ø§Ù„Ù„Ù‡! ØªÙ… Ø­ÙØ¸ "${name}". Ø§Ø³ØªÙ…Ø± ğŸŒŸ`;
    modalEl.style.display = 'none';
  }
});

// reset button
btnReset.addEventListener('click', ()=>{
  const ok = confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙ‚Ø¯Ù… Ù…Ù† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„ØªÙ‚Ø¯Ù… Ø§Ù„Ù…Ø®Ø²Ù† Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ.');
  if(!ok) return;
  localStorage.removeItem('quran_heart_progress');
  saved = {};
  segments.forEach(s => s.classList.remove('revealed'));
  updateUI();
  encourage.textContent = 'ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© ÙƒÙ„ Ø´ÙŠØ¡ â€” Ø¨Ø§Ù„ØªÙˆÙÙŠÙ‚ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø¬Ø¯ÙŠØ¯ ğŸŒ±';
});

// list saved
btnList.addEventListener('click', ()=>{
  const done = Object.keys(saved).filter(k=>k!=='_last');
  if(done.length === 0) return alert('Ù„Ù… ØªØ­ÙØ¸ Ø£ÙŠ Ø³ÙˆØ±Ø© Ø¨Ø¹Ø¯.');
  alert(`Ø§Ù„Ø³ÙˆØ± Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© (${done.length}):\n` + done.join(', '));
});

// load svg on start
loadAndInjectSVG();
</script>
</body>
</html>
